<!DOCTYPE html>

<html lang="he" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>page 1</title>
    <link id="pagestyle" rel="stylesheet" href="css/styles.css" type="text/css" />
    <script src="js/jquery-3.2.1.min.js" charset="utf-8"></script>
    <script src="js/scripts.js" charset="utf-8"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
    <script>

        function loadCSSLang(lang) {
    if (lang.localeCompare("heb") === 0) {
        swapStyleSheet('css/styles.css');
        localStorage.setItem("langID", "heb");
        loadLang();
    } else if (lang.localeCompare("eng") === 0) {
        localStorage.setItem("langID", "eng");
        swapStyleSheet('css/styles-eng.css');
        loadLang();
    }
}

       function loadLang() {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
        if (this.readyState === 4 && this.status === 200) {
            var myObj = JSON.parse(this.responseText);
            var pickLang = localStorage.getItem("langID");
            if (typeof pickLang !== 'undefined' && pickLang !== null) {
                console.log('load lang, lang id is: ' + pickLang);
                if (pickLang.localeCompare("heb") === 0) {
                    localStorage.setItem("langID", "heb");
                    $('#lang').css("background-image", "url('cut/Group 128.png')");
                    localStorage.setItem("lang", JSON.stringify(myObj.HE));
                } else {
                    localStorage.setItem("langID", "eng");
                    $('#lang').css("background-image", "url('cut/Group 312.png')");
                    localStorage.setItem("lang", JSON.stringify(myObj.EN));
                }
            } else {
                localStorage.setItem("langID", "heb");
                localStorage.setItem("lang", JSON.stringify(myObj.HE));
            }
             $('#name').text('');
             clearTxts('pageSubWrapper');
             loadAndFill();
        }
    };
    xmlhttp.open("GET", "js/lang.json", true);
    xmlhttp.send();
  }


        function pickLanguage() {
            var pickLang = getParameterByName("lang");
            var id = getParameterByName("id");
            var rfid = getParameterByName("rfid");
            if (typeof pickLang !== 'undefined' && pickLang !== null) {
                if (pickLang.localeCompare("heb") === 0) {       
                    localStorage.setItem("langID", "eng");
                    url ="cj2.html?id=" + id +'&lang=eng&rfid=' + rfid+ "";
                    window.location.replace(url);   
                    pickCSS();
                } else if (pickLang.localeCompare("eng") === 0) {
                    localStorage.setItem("langID", "heb");
                    url ="cj2.html?id=" + id +'&lang=heb&rfid=' + rfid+ "";
                    window.location.replace(url);                   
                    pickCSS();
                }
            } else {
                localStorage.setItem("langID", "heb");
                url = "cj2.html?id=" + id + '&lang=heb&rfid=' + rfid + "";
                window.location.replace(url);     
                pickCSS();
            }
        } 


        async function loadCountryInfo(searchValue) {
            //var langIs = localStorage.getItem('langID'); 
             var langIs = getLang();
            json = await getCountries();
            json = json.data;
            console.log(json);
            var filtered = $(json).filter(function (i, n) {
            var bool = false;
            for (j = 0; j < n.translations.length; j++) {
              if (n.ext_id.localeCompare(searchValue) === 0 && n.translations[j].language === langIs) {
                  res = n.translations[j];
                  if (n.image) {
                      console.log(`img id is: ${n.image.id}`);
                      var objImg = getImgDetails(n.image.id);
                     //$('#img').html(https://headless-cms.bh.org.il/uploads/beit-hatfutsot/originals/ + 'objImg.filename_disk'+);
                  }
                $('#name').text(res["name"]);
                $('#name,#split1').css("display", "inline-block");
                $('#txt1').text(res.timeline[0].info);
                $('#titleTxt2').text(res.timeline[0].timeframe);
                $('#txt2').text(res.timeline[0].info);
                $('#titleTxt3').text(res.timeline[1].timeframe);
                  $('#txt3').text(res.timeline[1].info);
                  var textShare = res.timeline[1].timeframe + "\n" +res.timeline[1].info;               
                  $('#telegram, #whatsapp').attr('data-title', textShare);

                for (i = 1; i < res.timeline.length; i++) {
                    j = i + 1;
                    console.log(res.timeline[i].timeframe);
                    var s = '<div class="text">';
                    s = s + '<div class="textSubTitle" id=' + 'titleTxt' + j + ' >' + res.timeline[i].timeframe + '</div>';
                    s = s + '<div id=' + 'txt' + j + ' class="infoTxt">' + res.timeline[i].info + '</div>';
                    s = s + '</div>';
                    document.getElementById('countryInfo').innerHTML += s;
                    }
                    bool = true;
             }
          }
           return bool;
          });
         return filtered;
        }


        function loadAndFill() {
            JsonLang = localStorage.getItem("lang");
            var lang = JSON.parse(JsonLang);
            $('#hdTitle').text(lang["hdTitles"]["communities"]);
            $('#catgMain').text(lang.countries)
            $("#close").val(lang.close);
            var num = getParameterByName('id');
            val = "30_" + num;
            loadCountryInfo(val);
            
        }


        function sendMail() {
            var currUrl = document.URL;
            var langIs = localStorage.getItem('langID');
            mail(langIs, currUrl);
        }
  
        $(function () {
            pickCSS();
            addModalbox();
            $('body').delegate('#catgMain', 'click', function () {
                var rfid = getParameterByName("rfid");
                location.href = "cj1.html?rfid=" + rfid;
            });
           

           
        });
    </script>
</head>

<body>
    <div class="header">
        <div class="headerWrapper">
            <div class="headerCont">
                <div class="langIcon" id="lang"  onclick="pickLanguage()"></div>
                <div class="titleCont"><div class="mainTitle" id="hdTitle">מסע בין קהילות</div></div>
                <div class="homeIcon" onclick="goHomePg()"></div>
            </div>
        </div>
        <div class="borderBtm"></div>
    </div>
    <div class="pageCont">
        <div class="pageWrapper">
            <div class="category">
                <span class="mainCat" id="catgMain" onclick="location.href = 'cj1.html';"></span>
                <span class="split" id="split1">&ensp;/&ensp;</span>
                <span class="subCat" id="name"></span>
            </div>
            <div class="sharingIcons">
                <span class="shareIcon" id="shareBtn"></span>
                <span class="mailIcon" onclick="sendMail()"></span>
            </div>

            <div class="pageSubCont">
                <div class="pageSubWrapper" id="countryInfo">
                    <div class="text" id="txt1">

                    </div>
                    <div class="shapeCont"><div id="img" class="imageShape"></div></div>
                    <!--<div class="text">
                        <div class="textSubTitle" id="titleTxt2"></div>
                        <div id="txt2" class="infoTxt">

                        </div>
                    </div>
                    <div class="text">
                        <div class="textSubTitle" id="titleTxt3"></div>
                        <div id="txt3" class="infoTxt">

                        </div>
                    </div>-->

                </div>
            </div>
            <div class="modal" id="shareModal">
                <div class="shareModalCont">

                    <div class='txtModal' id="share">
                        <a id="facebook" data-sharer="facebook" data-title="Checkout SJ3!" data-url=''  class="fa fa-facebook"></a>
                        <a id="twitter"  data-sharer="twitter" data-title="Checkout SJ3!" data-url=''   class="fa fa-twitter"></a>
                        <a id="linkedin" data-sharer="linkedin" data-title="Checkout SJ3!" data-url=''  class="fa fa-linkedin"></a>
                        <a id="instagram" data-sharer="instagram" data-title="Checkout SJ3!" data-url='' class="fa fa-instagram"></a>
                        <a id="telegram" data-sharer="telegram" data-title="Checkout SJ3!" data-url=''  class="fa fa-telegram"></a>
                        <a id="whatsapp" data-sharer="whatsapp" data-title="Checkout SJ3!" data-url=''  class="fa fa-whatsapp"></a>
                    </div>
                    <input class="close" type="button" value="" style="margin-top:240px" id="close"/>
                </div>
            </div>
        </div>
    </div>

</body>
</html>