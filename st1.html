<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>page 9</title>
    <link id="pagestyle" rel="stylesheet" href="css/styles.css" type="text/css" />
    <script src="js/jquery-3.2.1.min.js" charset="utf-8"></script>
    <script src="js/scripts.js" charset="utf-8"></script>
    <script>

          function pickCSS() {
              var pickLang = localStorage.getItem("langID");
              localStorage.clear();
            if (typeof pickLang !== 'undefined' && pickLang !== null) {
                if (pickLang.localeCompare("he") === 0) {
                    swapStyleSheet('css/styles.css');
                    localStorage.setItem("langID", "he");
                    loadLang();
                } else if (pickLang.localeCompare("en") === 0) {
                    localStorage.setItem("langID", "en");          
                    swapStyleSheet('css/styles-eng.css');
                    loadLang();
                }
            } else {
                pickLang = "he";
                localStorage.setItem("langID", "he");
                swapStyleSheet('css/styles.css');
                loadLang();
            }
        }

        function pickLanguage() {
            var pickLang = localStorage.getItem("langID");
            if (typeof pickLang !== 'undefined' && pickLang !== null) {
                if (pickLang.localeCompare("he") === 0) {
                    localStorage.setItem("langID", "en");
                     url = 'st1.html?lang=en';
                     window.location.replace(url);   
                     pickCSS(); 
                } else if (pickLang.localeCompare("en") === 0) {
                    localStorage.setItem("langID", "he");
                    url = 'st1.html?lang=he';
                     window.location.replace(url);  
                    pickCSS();
                }
            } else {
                localStorage.setItem("langID", "he");
                pickCSS();
            }
        }


        function loadLang() {
           var xmlhttp = new XMLHttpRequest();
           xmlhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                   var myObj = JSON.parse(this.responseText);
                   var pickLang = localStorage.getItem("langID");
                   localStorage.clear();
                   if (typeof pickLang !== 'undefined' && pickLang !== null) {
                       if (pickLang.localeCompare("he") === 0) {
                           localStorage.setItem("langID", "he");
                           $('#lang').css("background-image", "url('cut/Group 128.png')");
                           localStorage.setItem("lang", JSON.stringify(myObj.HE));
                       } else {
                           localStorage.setItem("langID", "en");
                           $('#lang').css("background-image", "url('cut/Group 312.png')");
                           localStorage.setItem("lang", JSON.stringify(myObj.EN));
                       }
                   } else {
                       localStorage.setItem("langID", "he");
                       localStorage.setItem("lang", JSON.stringify(myObj.HE));
                   }
                   loadData();
               }
           };
          xmlhttp.open("GET", "js/lang.json", true);
          xmlhttp.send();
         
        }

        async function loadData() {
            JsonLang = localStorage.getItem("lang");
            lang = JSON.parse(JsonLang);
            langIs = localStorage.getItem("langID");
            $('#hdTitle').text(lang["hdTitles"]["starts"]);
            $('#catgTitle').text(lang.starsTitle);
            object = await getStars();
            console.log(object);
            counter = 0;
            var s = "";
            for (var i in object) {
                subObj = object[i].translations;
                 var idstr = "";
                 if (object[i].ext_id) {
                  idstr = object[i].ext_id;
                 }
                var idIs = idstr.substring(3);
                for (var j in subObj) {
                    if (subObj[j]["language"].indexOf(langIs) > -1) {
                        counter++;
                        if (counter % 2 !== 0) {
                            s = s + '<div class="frameRow">';
                            s = s + '<div class="starFrame" id=' + 'imgFrame' + counter + '><span class="frameTitle" id=' + 'imgTitle' + counter + '  data=' +  idIs + '>'+ subObj[j].first_name + ' ' + subObj[j].last_name + '</span></div>';
                            s = s + '<span style="border-left:10px solid transparent;"></span>';
                        } else {
                            s = s + '<div class="starFrame" id=' + 'imgFrame' + counter + '><span class="frameTitle" id=' + 'imgTitle' + counter + '  data=' +  idIs + '>'+ subObj[j].first_name + ' ' + subObj[j].last_name + '</span></div>';
                            s = s + '</div>';
                        }
                           document.getElementById('content').innerHTML = s;
                    }
                }
            }
        }

        $(function () {
            pickCSS();
            $('body').delegate('.starFrame', 'click', function () {
                currId = this.id;
                var langIs=localStorage.getItem("langID");
                idNum = parseId(currId);
                name = $('#imgTitle' + idNum).text();
                var prData = "" + $('#imgTitle' + idNum).attr("data");
                val = parseInt(prData, 10);
                localStorage.setItem("prData", val)
                var rfid = getParameterByName("rfid");
                location.href = "st2.html?id=" + val + '&lang=' + langIs +'&rfid=' + rfid + "";;            
            });
        });
    </script>
</head>
<body>
    <div class="header">
        <div class="headerWrapper">
            <div class="headerCont">
                <div class="langIcon" id="lang" onclick="pickLanguage()"></div>
                <div class="titleCont"><div class="mainTitle" id="hdTitle">כוכבות</div></div>
                <div class="homeIcon" onclick="goHomePg()"></div>
            </div>
        </div>
        <div class="borderBtm"></div>
    </div>
    <div class="pageCont" id="st1">
        <div class="pageWrapper">
            <div class="categoryST"> 
                <span class="greenTitle" id="catgTitle"></span>
            </div>

            <div class="pageSubCont">
                <div class="pageSubWrapper" id="content">
            
                </div>
            </div>
        </div>
    </div>
</body>
</html>